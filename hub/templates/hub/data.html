{% extends "AutoHub/home.html" %}

{% block title %} View Data {% endblock %}
{% load static %}
{% block content %}
{% if user.is_authenticated %}
<h2>Home Data</h2>
<hr>
<div class="row">
    <div class="col-4"></div>
    <div class="col-4">
        <h5>Humidity</h5>
            <table id="humidity" class="table table-bordered table-striped table-responsive">
                <thead>
                    <tr><th>Room</th><th>Value</th><tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <h5>Temperature</h5>
            <table id="temperature" class="table table-striped table-responsive">
                <thead>
                    <tr><th>Room</th><th>Value</th><tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-4"></div>
</div>
{% else %}
<p>You must be signed in to view this page. Please click <a href="{% url 'login' %}">here</a> to sign in.</p>
{% endif %}
{% endblock %}

{% block script %}
<script type="text/javascript" src="{% static 'js/smoothie.js' %}"></script>
<script>
    var dataSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/hub/data/');

    dataSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        console.log(data);
        var message = data['message'];
        var parameter = data['parameter'];
        var name = data['name'];
        var table = document.getElementById(parameter);
        var row = table.insertRow(-1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        cell1.innerHTML = name;
        cell2.innerHTML = message;
    };

    dataSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };
</script>
{% endblock %}
